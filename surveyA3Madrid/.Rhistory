Datos_full$solo <- factor(Datos_full$solo, levels = c(1:3),labels=c("Alone","Accompanied","Accompanied with minors"))
Datos_full$combinar<- factor(Datos_full$combinar, levels = c(1:2),labels=c("Yes","No"))
Datos_full$aspectos<- factor(Datos_full$aspectos, levels = c(1:4),labels=c("Tiempo de viaje por congestion (nivel de trafico)","Incidencias en el medio elegido: obras, accidentes, huelgas en transporte publico","Meteorologia","Protocolos de contaminacion en Madrid capital"))
Datos_full<-Datos_full %>% mutate(conocimiento=case_when(
current_toll_diff>= -0.5 & current_toll_diff<= 0.5 ~ 0,
current_toll_diff< -0.5 ~ 1,
current_toll_diff> 0.5 ~ 2,
current_toll == "No" ~ 3,
))
Datos_full$conocimiento<-factor(Datos_full$conocimiento)
Datos_full<-Datos_full %>% mutate(ahorrotiempo1=tiempo_viaje - Duracion_Coche_R3)
Datos_full<-Datos_full %>% mutate(tiempo2 = tiempo_viaje * tiempo_viaje)
openxlsx::write.xlsx(Datos_full,"Datos_full.xlsx")
dataSurveyA3<-Datos_full[,c("REGISTRO","municipio","seccion_censal","frec_madrid","genero","edad","edad_cat","sit_laboral","ingreso","estudios","carnet","vehiculo","abono","tipo_dia","tipo_dia2","P12","hora_franja","tiempo_viaje","tiempo2","motivo_viaje","motivo_viaje_2","modo","modo_bis","ruta","P15_B","combinar","solo","frec_viaje","aspectos","current_toll","current_toll_tarifa","current_toll_diff","conocimiento","wtp","wtp_tarifa","wtp_tarifa_2","abono_mensual","abono_mensual_tarifa","vineta_mensual_tarifa_2","carpooling","carpooling_descuento","carpooling_descuento_2","descuento_carpool","elegiria_bus_arganda","elegiria_bus_rivas","elegiria_bus","elegiria_metro_arganda","elegiria_metro_rivas","elegiria_metro","zona_metro","Distancia_min_metro","Parada_bus","Distrito_Destino_Name","Barrio_Destino_Name","dist_peaje","ahorrotiempo1","cluster_A_1","cluster_A_2","cluster_A_4","cluster_A_5","cluster_A_7","cluster_A_8","cluster_A_10","cluster_A_11","cluster_RA_1","cluster_RA_2","cluster_RA_3","cluster_RA_4","cluster_RA_5","cluster_RA_6","cluster_RA_7","cluster_RA_8","cluster_RA_9","cluster_RA_10","cluster_RA_11","cluster_RA_12","ArgRiv_Cluster_Income","ArgRiv_Cluster_Age","ArgRiv_Cluster_Women","ArgRiv_Cluster_Right_Wing")]
save(dataSurveyA3, file = "dataSurveyA3.RData")
dataSurveyA3$modo<-droplevels(dataSurveyA3$modo) # Quitamos VTC y Bus discreccional
dataSurveyA3$modo_bis<-droplevels(dataSurveyA3$modo_bis)# Quitamos VTC y Bus discreccional
# Unimos taxi a coche
dataSurveyA3$modo<-factor(dataSurveyA3$modo,levels=c("Car 1","Moto 1","Bus 1","Metro 1","Taxi 1"),labels=c("Car 1","Moto 1","Bus 1","Metro 1","Car 1"))
dataSurveyA3$modo_bis<-factor(dataSurveyA3$modo_bis,levels=c("Car","Moto","Bus","Metro","Taxi","R3"),labels=c("Car","Moto","Bus","Metro","Car","R3"))
# Juntamos No estudios y estudios primarios.
dataSurveyA3$estudios<-factor(dataSurveyA3$estudios,levels=c("No studies","Primary studies","Secondary studies","University studies"),labels=c("No studies or Primary Studies","No studies or Primary Studies","Secondary studies","University studies"))
# Carnet de conducir
dataSurveyA3$carnet<-factor(dataSurveyA3$carnet,levels=c("No driving licence","Moto driving licence","Car driving licence","Moto and car driving licence","Not applicable"),labels=c("No driving licence","Moto or car driving licence","Moto or car driving licence","Moto and car driving licence","No driving licence"))
# Sit_laboral
dataSurveyA3$sit_laboral<-factor(dataSurveyA3$sit_laboral,levels=c("Employed","Student","Employed Student","Unpaid domestic labour","Retired","Pensioner","Unemployed Looking","Unemployed Not Looking","Other situation"),labels=c("Employed","Student","Student","Unpaid domestic labour","Retired, pensioner and others","Retired, pensioner and others","Unemployed Looking","Retired, pensioner and others","Retired, pensioner and others"))
# Edad
dataSurveyA3$edad_cat<-factor(dataSurveyA3$edad_cat,levels=c("Under 16","From 16 to 26","From 27 to 34","From 35 to 49","From 50 to 64","Above 64"),labels=c("Under 26","Under 26","From 27 to 34","From 35 to 49","From 50 to 64","Above 64" ))
# hora_franja
dataSurveyA3$hora_franja<-factor(dataSurveyA3$hora_franja,levels=c("Peak morning","Non peak morning","Afternoon","Peak evening","Non peak evening","Night"),labels=c("Peak morning","Non peak morning","Afternoon","Peak evening","Non peak evening and night","Non peak evening and night"))
# vehiculo
dataSurveyA3$vehiculo<-factor(dataSurveyA3$vehiculo,levels=c("Not available","Yes Driver","Yes ST Driver","Yes No Driver","Yes Passenger"),labels=c("Not available","Yes Driver","Yes ST Driver","Yes ST Driver","Yes Passenger"))
dataSurveyA3_processed<-dataSurveyA3
openxlsx::write.xlsx(dataSurveyA3_processed,"dataSurveyA3_processed.xlsx")
save(dataSurveyA3_processed, file = "dataSurveyA3Processed.RData")
devtools::document()
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message=FALSE)
# setwd("C:/Users/romero/OneDrive - UNED/Papers/Paper 3/Models_R")
setwd("~/OneDrive - UNED/Papers/Paper 3/Models_R")
library("readxl")
library("tidyverse")
# Datos_Finales_Aux <- read_excel("C:/Users/romero/OneDrive - UNED/Papers/Paper 3/Models_Stata/Datos_Finales_Aux_FR_20191027.xlsx")
Datos_Finales_Aux <- read_excel("~/OneDrive - UNED/Papers/Paper 3/Models_Stata/Datos_Finales_Aux_FR_20191027.xlsx")
colnames(Datos_Finales_Aux)[which(names(Datos_Finales_Aux)=="dist_Peaje...193")]<-"dist_peaje"
colnames(Datos_Finales_Aux)[which(names(Datos_Finales_Aux)=="dist_Peaje...222")]<-"dist_peaje_bis"
colnames(Datos_Finales_Aux)[which(names(Datos_Finales_Aux)=="dur_Peaje...192")]<-"dur_peaje"
colnames(Datos_Finales_Aux)[which(names(Datos_Finales_Aux)=="dist_Peaje...223")]<-"dist_peaje_bis"
Datos_Finales_Aux<-Datos_Finales_Aux %>% select(-starts_with("P16"))%>% select(-starts_with("P17"))%>% select(-starts_with("P20"))%>% select(-starts_with("P21"))
Datos_Finales_Aux$seccion_censal<-as.character(Datos_Finales_Aux$seccion_censal)
Datos_Finales_Aux<-Datos_Finales_Aux %>% mutate(CensusSection = case_when(
seccion_censal=="2812301042" ~ "2812301008",
seccion_censal=="2812301043" ~ "2812301019",
seccion_censal=="2812301044" ~ "2812301022",
seccion_censal=="2812301045" ~ "2812301037",
TRUE ~ seccion_censal))
# Output_Cluster <- read_excel("C:/Users/romero/OneDrive - UNED/Papers/Paper 3/Excels_Resultados/Output_Cluster.xlsx")
Output_Cluster <- read_excel("~/OneDrive - UNED/Papers/Paper 3/Excels_Resultados/Output_Cluster.xlsx")
Output_Cluster$CensusSection<-as.character(Output_Cluster$CensusSection)
colnames(Output_Cluster)[which(names(Output_Cluster)=="Input_Cl_1_RA_1")]<-"ArgRiv_Cluster_Income"
colnames(Output_Cluster)[which(names(Output_Cluster)=="Input_Cl_2_RA_4")]<-"ArgRiv_Cluster_Age"
colnames(Output_Cluster)[which(names(Output_Cluster)=="Input_Cl_1_RA_4")]<-"ArgRiv_Cluster_Women"
colnames(Output_Cluster)[which(names(Output_Cluster)=="Input_Cl_4_RA_7")]<-"ArgRiv_Cluster_Right_Wing"
Output_Cluster<-Output_Cluster %>% select(-starts_with("Input_"))
Datos_full<-full_join(Datos_Finales_Aux,Output_Cluster,by="CensusSection")
Datos_full$elegiria_metro<-as.numeric(Datos_full$elegiria_metro)
Datos_full$elegiria_bus<-as.numeric(Datos_full$elegiria_bus)
Datos_full$current_toll<-factor(Datos_full$current_toll,levels=c("1","2"),labels=c("Si","No"))
Datos_full$wtp<-factor(Datos_full$wtp,levels = c("1","2","3"),labels=c("Si","No","No_Destino"))
Datos_full$abono_mensual<-factor(Datos_full$abono_mensual,levels = c("1","2"),labels=c("Si","No"))
Datos_full$carpooling<-factor(Datos_full$carpooling,levels=c("1","2"),labels=c("Si","No"))
Datos_full <- Datos_full %>% mutate(descuento_carpool=case_when(
carpooling=="No" ~ 0,
TRUE ~ 3.2-carpooling_descuento))
Datos_full$seccion_censal<-factor(Datos_full$seccion_censal)
Datos_full$cluster_A_1<-factor(Datos_full$cluster_A_1)
Datos_full$cluster_A_2<-factor(Datos_full$cluster_A_2)
Datos_full$cluster_A_4<-factor(Datos_full$cluster_A_4)
Datos_full$cluster_A_5<-factor(Datos_full$cluster_A_5)
Datos_full$cluster_A_7<-factor(Datos_full$cluster_A_7)
Datos_full$cluster_A_8<-factor(Datos_full$cluster_A_8)
Datos_full$cluster_A_10<-factor(Datos_full$cluster_A_10)
Datos_full$cluster_A_11<-factor(Datos_full$cluster_A_11)
Datos_full$cluster_RA_1<-factor(Datos_full$cluster_RA_1)
Datos_full$cluster_RA_2<-factor(Datos_full$cluster_RA_2)
Datos_full$cluster_RA_3<-factor(Datos_full$cluster_RA_3)
Datos_full$cluster_RA_4<-factor(Datos_full$cluster_RA_4)
Datos_full$cluster_RA_5<-factor(Datos_full$cluster_RA_5)
Datos_full$cluster_RA_6<-factor(Datos_full$cluster_RA_6)
Datos_full$cluster_RA_7<-factor(Datos_full$cluster_RA_7)
Datos_full$cluster_RA_8<-factor(Datos_full$cluster_RA_8)
Datos_full$cluster_RA_9<-factor(Datos_full$cluster_RA_9)
Datos_full$cluster_RA_10<-factor(Datos_full$cluster_RA_10)
Datos_full$cluster_RA_11<-factor(Datos_full$cluster_RA_11)
Datos_full$cluster_RA_12<-factor(Datos_full$cluster_RA_12)
Datos_full$municipio <- factor(Datos_full$municipio, levels=c(28014,28123),labels = c("Arganda","Rivas"))
Datos_full$zona_metro<-factor(Datos_full$zona_metro)
Datos_full$Parada_bus<-factor(Datos_full$Parada_bus)
Datos_full$Distrito_Destino_Name<-factor(Datos_full$Distrito_Destino_Name)
Datos_full$Barrio_Destino_Name<-factor(Datos_full$Barrio_Destino_Name)
Datos_full$edad_cat<-factor(Datos_full$edad_cat,levels = c(1:6),labels=c("Under 16","From 16 to 26","From 27 to 34","From 35 to 49","From 50 to 64","Above 64"))
Datos_full$genero<-factor(Datos_full$genero,levels = c(1,2),labels=c("Male","Female"))
Datos_full$ingreso<-factor(Datos_full$ingreso,levels = c(1,2,3,4,5,99),labels=c("Under 900 €","From 900 € to 1600 €","From 1600 € to 2500 €", "From 2500 € to 3000 €", "Above 3000 €", "Not responding"))
Datos_full$estudios<-factor(Datos_full$estudios,levels = c(1:4),labels=c("No studies","Primary studies","Secondary studies","University studies"))
Datos_full$sit_laboral<- factor(Datos_full$sit_laboral,levels=c(1:9),labels=c("Employed","Student","Employed Student","Unpaid domestic labour","Retired","Pensioner","Unemployed Looking","Unemployed Not Looking","Other situation"))
Datos_full$vehiculo <- factor(Datos_full$vehiculo,levels=c(1:5),labels=c("Not available","Yes Driver","Yes ST Driver","Yes No Driver","Yes Passenger"))
Datos_full$carnet <- factor(Datos_full$carnet, levels=c(1:5),labels=c("No driving licence","Moto driving licence","Car driving licence","Moto and car driving licence","Not applicable"))
Datos_full$abono <-factor(Datos_full$abono,levels = c(2,1),labels=c("No transit pass","Yes transit pass"))
Datos_full$frec_madrid<- factor(Datos_full$frec_madrid,levels=c(1:3),labels=c("More 3days","1 3days","Once or twice a month"))
Datos_full$frec_viaje<- factor(Datos_full$frec_viaje,levels=c(1:4),labels=c("4 o mas dias a la semana","1 3 dias a la semana","1 2 veces al mes","Menos de una vez al mes"))
Datos_full$modo <- factor(Datos_full$modo, levels= c(1:7),labels=c("Car 1","Moto 1","Bus 1","Metro 1","Taxi 1","VTC 1","Bus Discrecional 1"))
Datos_full$modo_bis <- factor(Datos_full$modo_bis, levels= c(1:8),labels=c("Car","Moto","Bus","Metro","Taxi","VTC","Bus Discrecional","R3"))
Datos_full$tipo_dia <- factor(Datos_full$tipo_dia, levels=c(1:7),labels = c("Monday 1","Tuesday 1","Wednesday 1","Thursday 1","Friday 1","Saturday 1","Sunday 1"))
Datos_full$tipo_dia2 <- factor(Datos_full$tipo_dia2, levels=c("1","1","1","1","1","2","3"),labels = c("Weekday","Weekday","Weekday","Weekday","Weekday","Saturday","Sunday"))
Datos_full$motivo_viaje <- factor(Datos_full$motivo_viaje, levels=c(1:8),labels = c("Work Studies","Working Affairs","Personal Affairs","Leisure","Shopping","Doctor","Visiting Friends","Other purpose"))
Datos_full$motivo_viaje_2<-factor(Datos_full$motivo_viaje_2, levels=c("1","2"),labels=c("Commuting","Non commuting"))
Datos_full$ruta<-factor(Datos_full$ruta,levels=c(1:2),labels=c("A3","R3"))
Datos_full$P15_B<-factor(Datos_full$P15_B,levels=c(1:2),labels=c("Driver","Rider"))
Datos_full$hora_franja <- factor(Datos_full$hora_franja, levels=c("1","2","3","4","5","6"),labels = c("Peak morning","Non peak morning","Afternoon","Peak evening","Non peak evening","Night"))
Datos_full$solo <- factor(Datos_full$solo, levels = c(1:3),labels=c("Alone","Accompanied","Accompanied with minors"))
Datos_full$combinar<- factor(Datos_full$combinar, levels = c(1:2),labels=c("Yes","No"))
Datos_full$aspectos<- factor(Datos_full$aspectos, levels = c(1:4),labels=c("Tiempo de viaje por congestion (nivel de trafico)","Incidencias en el medio elegido: obras, accidentes, huelgas en transporte publico","Meteorologia","Protocolos de contaminacion en Madrid capital"))
Datos_full<-Datos_full %>% mutate(conocimiento=case_when(
current_toll_diff>= -0.5 & current_toll_diff<= 0.5 ~ 0,
current_toll_diff< -0.5 ~ 1,
current_toll_diff> 0.5 ~ 2,
current_toll == "No" ~ 3,
))
Datos_full$conocimiento<-factor(Datos_full$conocimiento)
Datos_full<-Datos_full %>% mutate(ahorrotiempo1=tiempo_viaje - Duracion_Coche_R3)
Datos_full<-Datos_full %>% mutate(tiempo2 = tiempo_viaje * tiempo_viaje)
openxlsx::write.xlsx(Datos_full,"Datos_full.xlsx")
dataSurveyA3<-Datos_full[,c("REGISTRO","municipio","seccion_censal","frec_madrid","genero","edad","edad_cat","sit_laboral","ingreso","estudios","carnet","vehiculo","abono","tipo_dia","tipo_dia2","P12","hora_franja","tiempo_viaje","tiempo2","motivo_viaje","motivo_viaje_2","modo","modo_bis","ruta","P15_B","combinar","solo","frec_viaje","aspectos","current_toll","current_toll_tarifa","current_toll_diff","conocimiento","wtp","wtp_tarifa","wtp_tarifa_2","abono_mensual","abono_mensual_tarifa","vineta_mensual_tarifa_2","carpooling","carpooling_descuento","carpooling_descuento_2","descuento_carpool","elegiria_bus_arganda","elegiria_bus_rivas","elegiria_bus","elegiria_metro_arganda","elegiria_metro_rivas","elegiria_metro","zona_metro","Distancia_min_metro","Parada_bus","Distrito_Destino_Name","Barrio_Destino_Name","dist_peaje","ahorrotiempo1","cluster_A_1","cluster_A_2","cluster_A_4","cluster_A_5","cluster_A_7","cluster_A_8","cluster_A_10","cluster_A_11","cluster_RA_1","cluster_RA_2","cluster_RA_3","cluster_RA_4","cluster_RA_5","cluster_RA_6","cluster_RA_7","cluster_RA_8","cluster_RA_9","cluster_RA_10","cluster_RA_11","cluster_RA_12","ArgRiv_Cluster_Income","ArgRiv_Cluster_Age","ArgRiv_Cluster_Women","ArgRiv_Cluster_Right_Wing")]
save(dataSurveyA3, file = "dataSurveyA3.RData")
dataSurveyA3$modo<-droplevels(dataSurveyA3$modo) # Quitamos VTC y Bus discreccional
dataSurveyA3$modo_bis<-droplevels(dataSurveyA3$modo_bis)# Quitamos VTC y Bus discreccional
# Unimos taxi a coche
dataSurveyA3$modo<-factor(dataSurveyA3$modo,levels=c("Car 1","Moto 1","Bus 1","Metro 1","Taxi 1"),labels=c("Car 1","Moto 1","Bus 1","Metro 1","Car 1"))
dataSurveyA3$modo_bis<-factor(dataSurveyA3$modo_bis,levels=c("Car","Moto","Bus","Metro","Taxi","R3"),labels=c("Car","Moto","Bus","Metro","Car","R3"))
# Juntamos No estudios y estudios primarios.
dataSurveyA3$estudios<-factor(dataSurveyA3$estudios,levels=c("No studies","Primary studies","Secondary studies","University studies"),labels=c("No studies or Primary Studies","No studies or Primary Studies","Secondary studies","University studies"))
# Carnet de conducir
dataSurveyA3$carnet<-factor(dataSurveyA3$carnet,levels=c("No driving licence","Moto driving licence","Car driving licence","Moto and car driving licence","Not applicable"),labels=c("No driving licence","Moto or car driving licence","Moto or car driving licence","Moto and car driving licence","No driving licence"))
# Sit_laboral
dataSurveyA3$sit_laboral<-factor(dataSurveyA3$sit_laboral,levels=c("Employed","Student","Employed Student","Unpaid domestic labour","Retired","Pensioner","Unemployed Looking","Unemployed Not Looking","Other situation"),labels=c("Employed","Student","Student","Unpaid domestic labour","Retired, pensioner and others","Retired, pensioner and others","Unemployed Looking","Retired, pensioner and others","Retired, pensioner and others"))
# Edad
dataSurveyA3$edad_cat<-factor(dataSurveyA3$edad_cat,levels=c("Under 16","From 16 to 26","From 27 to 34","From 35 to 49","From 50 to 64","Above 64"),labels=c("Under 26","Under 26","From 27 to 34","From 35 to 49","From 50 to 64","Above 64" ))
# hora_franja
dataSurveyA3$hora_franja<-factor(dataSurveyA3$hora_franja,levels=c("Peak morning","Non peak morning","Afternoon","Peak evening","Non peak evening","Night"),labels=c("Peak morning","Non peak morning","Afternoon","Peak evening","Non peak evening and night","Non peak evening and night"))
# vehiculo
dataSurveyA3$vehiculo<-factor(dataSurveyA3$vehiculo,levels=c("Not available","Yes Driver","Yes ST Driver","Yes No Driver","Yes Passenger"),labels=c("Not available","Yes Driver","Yes ST Driver","Yes ST Driver","Yes Passenger"))
openxlsx::write.xlsx(dataSurveyA3,"dataSurveyA3_processed.xlsx")
save(dataSurveyA3, file = "dataSurveyA3Processed.RData")
devtools::document()
devtools::document()
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message=FALSE)
# setwd("C:/Users/romero/OneDrive - UNED/Papers/Paper 3/Models_R")
setwd("~/OneDrive - UNED/Papers/Paper 3/Models_R")
library("readxl")
library("tidyverse")
# Datos_Finales_Aux <- read_excel("C:/Users/romero/OneDrive - UNED/Papers/Paper 3/Models_Stata/Datos_Finales_Aux_FR_20191027.xlsx")
Datos_Finales_Aux <- read_excel("~/OneDrive - UNED/Papers/Paper 3/Models_Stata/Datos_Finales_Aux_FR_20191027.xlsx")
colnames(Datos_Finales_Aux)[which(names(Datos_Finales_Aux)=="dist_Peaje...193")]<-"dist_peaje"
colnames(Datos_Finales_Aux)[which(names(Datos_Finales_Aux)=="dist_Peaje...222")]<-"dist_peaje_bis"
colnames(Datos_Finales_Aux)[which(names(Datos_Finales_Aux)=="dur_Peaje...192")]<-"dur_peaje"
colnames(Datos_Finales_Aux)[which(names(Datos_Finales_Aux)=="dist_Peaje...223")]<-"dist_peaje_bis"
Datos_Finales_Aux<-Datos_Finales_Aux %>% select(-starts_with("P16"))%>% select(-starts_with("P17"))%>% select(-starts_with("P20"))%>% select(-starts_with("P21"))
Datos_Finales_Aux$seccion_censal<-as.character(Datos_Finales_Aux$seccion_censal)
Datos_Finales_Aux<-Datos_Finales_Aux %>% mutate(CensusSection = case_when(
seccion_censal=="2812301042" ~ "2812301008",
seccion_censal=="2812301043" ~ "2812301019",
seccion_censal=="2812301044" ~ "2812301022",
seccion_censal=="2812301045" ~ "2812301037",
TRUE ~ seccion_censal))
# Output_Cluster <- read_excel("C:/Users/romero/OneDrive - UNED/Papers/Paper 3/Excels_Resultados/Output_Cluster.xlsx")
Output_Cluster <- read_excel("~/OneDrive - UNED/Papers/Paper 3/Excels_Resultados/Output_Cluster.xlsx")
Output_Cluster$CensusSection<-as.character(Output_Cluster$CensusSection)
colnames(Output_Cluster)[which(names(Output_Cluster)=="Input_Cl_1_RA_1")]<-"ArgRiv_Cluster_Income"
colnames(Output_Cluster)[which(names(Output_Cluster)=="Input_Cl_2_RA_4")]<-"ArgRiv_Cluster_Age"
colnames(Output_Cluster)[which(names(Output_Cluster)=="Input_Cl_1_RA_4")]<-"ArgRiv_Cluster_Women"
colnames(Output_Cluster)[which(names(Output_Cluster)=="Input_Cl_4_RA_7")]<-"ArgRiv_Cluster_Right_Wing"
Output_Cluster<-Output_Cluster %>% select(-starts_with("Input_"))
Datos_full<-full_join(Datos_Finales_Aux,Output_Cluster,by="CensusSection")
Datos_full$elegiria_metro<-as.numeric(Datos_full$elegiria_metro)
Datos_full$elegiria_bus<-as.numeric(Datos_full$elegiria_bus)
Datos_full$current_toll<-factor(Datos_full$current_toll,levels=c("1","2"),labels=c("Si","No"))
Datos_full$wtp<-factor(Datos_full$wtp,levels = c("1","2","3"),labels=c("Si","No","No_Destino"))
Datos_full$abono_mensual<-factor(Datos_full$abono_mensual,levels = c("1","2"),labels=c("Si","No"))
Datos_full$carpooling<-factor(Datos_full$carpooling,levels=c("1","2"),labels=c("Si","No"))
Datos_full <- Datos_full %>% mutate(descuento_carpool=case_when(
carpooling=="No" ~ 0,
TRUE ~ 3.2-carpooling_descuento))
Datos_full$seccion_censal<-factor(Datos_full$seccion_censal)
Datos_full$cluster_A_1<-factor(Datos_full$cluster_A_1)
Datos_full$cluster_A_2<-factor(Datos_full$cluster_A_2)
Datos_full$cluster_A_4<-factor(Datos_full$cluster_A_4)
Datos_full$cluster_A_5<-factor(Datos_full$cluster_A_5)
Datos_full$cluster_A_7<-factor(Datos_full$cluster_A_7)
Datos_full$cluster_A_8<-factor(Datos_full$cluster_A_8)
Datos_full$cluster_A_10<-factor(Datos_full$cluster_A_10)
Datos_full$cluster_A_11<-factor(Datos_full$cluster_A_11)
Datos_full$cluster_RA_1<-factor(Datos_full$cluster_RA_1)
Datos_full$cluster_RA_2<-factor(Datos_full$cluster_RA_2)
Datos_full$cluster_RA_3<-factor(Datos_full$cluster_RA_3)
Datos_full$cluster_RA_4<-factor(Datos_full$cluster_RA_4)
Datos_full$cluster_RA_5<-factor(Datos_full$cluster_RA_5)
Datos_full$cluster_RA_6<-factor(Datos_full$cluster_RA_6)
Datos_full$cluster_RA_7<-factor(Datos_full$cluster_RA_7)
Datos_full$cluster_RA_8<-factor(Datos_full$cluster_RA_8)
Datos_full$cluster_RA_9<-factor(Datos_full$cluster_RA_9)
Datos_full$cluster_RA_10<-factor(Datos_full$cluster_RA_10)
Datos_full$cluster_RA_11<-factor(Datos_full$cluster_RA_11)
Datos_full$cluster_RA_12<-factor(Datos_full$cluster_RA_12)
Datos_full$municipio <- factor(Datos_full$municipio, levels=c(28014,28123),labels = c("Arganda","Rivas"))
Datos_full$zona_metro<-factor(Datos_full$zona_metro)
Datos_full$Parada_bus<-factor(Datos_full$Parada_bus)
Datos_full$Distrito_Destino_Name<-factor(Datos_full$Distrito_Destino_Name)
Datos_full$Barrio_Destino_Name<-factor(Datos_full$Barrio_Destino_Name)
Datos_full$edad_cat<-factor(Datos_full$edad_cat,levels = c(1:6),labels=c("Under 16","From 16 to 26","From 27 to 34","From 35 to 49","From 50 to 64","Above 64"))
Datos_full$genero<-factor(Datos_full$genero,levels = c(1,2),labels=c("Male","Female"))
Datos_full$ingreso<-factor(Datos_full$ingreso,levels = c(1,2,3,4,5,99),labels=c("Under 900 €","From 900 € to 1600 €","From 1600 € to 2500 €", "From 2500 € to 3000 €", "Above 3000 €", "Not responding"))
Datos_full$estudios<-factor(Datos_full$estudios,levels = c(1:4),labels=c("No studies","Primary studies","Secondary studies","University studies"))
Datos_full$sit_laboral<- factor(Datos_full$sit_laboral,levels=c(1:9),labels=c("Employed","Student","Employed Student","Unpaid domestic labour","Retired","Pensioner","Unemployed Looking","Unemployed Not Looking","Other situation"))
Datos_full$vehiculo <- factor(Datos_full$vehiculo,levels=c(1:5),labels=c("Not available","Yes Driver","Yes ST Driver","Yes No Driver","Yes Passenger"))
Datos_full$carnet <- factor(Datos_full$carnet, levels=c(1:5),labels=c("No driving licence","Moto driving licence","Car driving licence","Moto and car driving licence","Not applicable"))
Datos_full$abono <-factor(Datos_full$abono,levels = c(2,1),labels=c("No transit pass","Yes transit pass"))
Datos_full$frec_madrid<- factor(Datos_full$frec_madrid,levels=c(1:3),labels=c("More 3days","1 3days","Once or twice a month"))
Datos_full$frec_viaje<- factor(Datos_full$frec_viaje,levels=c(1:4),labels=c("4 o mas dias a la semana","1 3 dias a la semana","1 2 veces al mes","Menos de una vez al mes"))
Datos_full$modo <- factor(Datos_full$modo, levels= c(1:7),labels=c("Car 1","Moto 1","Bus 1","Metro 1","Taxi 1","VTC 1","Bus Discrecional 1"))
Datos_full$modo_bis <- factor(Datos_full$modo_bis, levels= c(1:8),labels=c("Car","Moto","Bus","Metro","Taxi","VTC","Bus Discrecional","R3"))
Datos_full$tipo_dia <- factor(Datos_full$tipo_dia, levels=c(1:7),labels = c("Monday 1","Tuesday 1","Wednesday 1","Thursday 1","Friday 1","Saturday 1","Sunday 1"))
Datos_full$tipo_dia2 <- factor(Datos_full$tipo_dia2, levels=c("1","1","1","1","1","2","3"),labels = c("Weekday","Weekday","Weekday","Weekday","Weekday","Saturday","Sunday"))
Datos_full$motivo_viaje <- factor(Datos_full$motivo_viaje, levels=c(1:8),labels = c("Work Studies","Working Affairs","Personal Affairs","Leisure","Shopping","Doctor","Visiting Friends","Other purpose"))
Datos_full$motivo_viaje_2<-factor(Datos_full$motivo_viaje_2, levels=c("1","2"),labels=c("Commuting","Non commuting"))
Datos_full$ruta<-factor(Datos_full$ruta,levels=c(1:2),labels=c("A3","R3"))
Datos_full$P15_B<-factor(Datos_full$P15_B,levels=c(1:2),labels=c("Driver","Rider"))
Datos_full$hora_franja <- factor(Datos_full$hora_franja, levels=c("1","2","3","4","5","6"),labels = c("Peak morning","Non peak morning","Afternoon","Peak evening","Non peak evening","Night"))
Datos_full$solo <- factor(Datos_full$solo, levels = c(1:3),labels=c("Alone","Accompanied","Accompanied with minors"))
Datos_full$combinar<- factor(Datos_full$combinar, levels = c(1:2),labels=c("Yes","No"))
Datos_full$aspectos<- factor(Datos_full$aspectos, levels = c(1:4),labels=c("Tiempo de viaje por congestion (nivel de trafico)","Incidencias en el medio elegido: obras, accidentes, huelgas en transporte publico","Meteorologia","Protocolos de contaminacion en Madrid capital"))
Datos_full<-Datos_full %>% mutate(conocimiento=case_when(
current_toll_diff>= -0.5 & current_toll_diff<= 0.5 ~ 0,
current_toll_diff< -0.5 ~ 1,
current_toll_diff> 0.5 ~ 2,
current_toll == "No" ~ 3,
))
Datos_full$conocimiento<-factor(Datos_full$conocimiento)
Datos_full<-Datos_full %>% mutate(ahorrotiempo1=tiempo_viaje - Duracion_Coche_R3)
Datos_full<-Datos_full %>% mutate(tiempo2 = tiempo_viaje * tiempo_viaje)
openxlsx::write.xlsx(Datos_full,"Datos_full.xlsx")
dataSurveyA3<-Datos_full[,c("REGISTRO","municipio","seccion_censal","frec_madrid","genero","edad","edad_cat","sit_laboral","ingreso","estudios","carnet","vehiculo","abono","tipo_dia","tipo_dia2","P12","hora_franja","tiempo_viaje","tiempo2","motivo_viaje","motivo_viaje_2","modo","modo_bis","ruta","P15_B","combinar","solo","frec_viaje","aspectos","current_toll","current_toll_tarifa","current_toll_diff","conocimiento","wtp","wtp_tarifa","wtp_tarifa_2","abono_mensual","abono_mensual_tarifa","vineta_mensual_tarifa_2","carpooling","carpooling_descuento","carpooling_descuento_2","descuento_carpool","elegiria_bus_arganda","elegiria_bus_rivas","elegiria_bus","elegiria_metro_arganda","elegiria_metro_rivas","elegiria_metro","zona_metro","Distancia_min_metro","Parada_bus","Distrito_Destino_Name","Barrio_Destino_Name","dist_peaje","ahorrotiempo1","cluster_A_1","cluster_A_2","cluster_A_4","cluster_A_5","cluster_A_7","cluster_A_8","cluster_A_10","cluster_A_11","cluster_RA_1","cluster_RA_2","cluster_RA_3","cluster_RA_4","cluster_RA_5","cluster_RA_6","cluster_RA_7","cluster_RA_8","cluster_RA_9","cluster_RA_10","cluster_RA_11","cluster_RA_12","ArgRiv_Cluster_Income","ArgRiv_Cluster_Age","ArgRiv_Cluster_Women","ArgRiv_Cluster_Right_Wing")]
save(dataSurveyA3, file = "dataSurveyA3.RData")
dataSurveyA3$modo<-droplevels(dataSurveyA3$modo) # Quitamos VTC y Bus discreccional
dataSurveyA3$modo_bis<-droplevels(dataSurveyA3$modo_bis)# Quitamos VTC y Bus discreccional
# Unimos taxi a coche
dataSurveyA3$modo<-factor(dataSurveyA3$modo,levels=c("Car 1","Moto 1","Bus 1","Metro 1","Taxi 1"),labels=c("Car 1","Moto 1","Bus 1","Metro 1","Car 1"))
dataSurveyA3$modo_bis<-factor(dataSurveyA3$modo_bis,levels=c("Car","Moto","Bus","Metro","Taxi","R3"),labels=c("Car","Moto","Bus","Metro","Car","R3"))
# Juntamos No estudios y estudios primarios.
dataSurveyA3$estudios<-factor(dataSurveyA3$estudios,levels=c("No studies","Primary studies","Secondary studies","University studies"),labels=c("No studies or Primary Studies","No studies or Primary Studies","Secondary studies","University studies"))
# Carnet de conducir
dataSurveyA3$carnet<-factor(dataSurveyA3$carnet,levels=c("No driving licence","Moto driving licence","Car driving licence","Moto and car driving licence","Not applicable"),labels=c("No driving licence","Moto or car driving licence","Moto or car driving licence","Moto and car driving licence","No driving licence"))
# Sit_laboral
dataSurveyA3$sit_laboral<-factor(dataSurveyA3$sit_laboral,levels=c("Employed","Student","Employed Student","Unpaid domestic labour","Retired","Pensioner","Unemployed Looking","Unemployed Not Looking","Other situation"),labels=c("Employed","Student","Student","Unpaid domestic labour","Retired, pensioner and others","Retired, pensioner and others","Unemployed Looking","Retired, pensioner and others","Retired, pensioner and others"))
# Edad
dataSurveyA3$edad_cat<-factor(dataSurveyA3$edad_cat,levels=c("Under 16","From 16 to 26","From 27 to 34","From 35 to 49","From 50 to 64","Above 64"),labels=c("Under 26","Under 26","From 27 to 34","From 35 to 49","From 50 to 64","Above 64" ))
# hora_franja
dataSurveyA3$hora_franja<-factor(dataSurveyA3$hora_franja,levels=c("Peak morning","Non peak morning","Afternoon","Peak evening","Non peak evening","Night"),labels=c("Peak morning","Non peak morning","Afternoon","Peak evening","Non peak evening and night","Non peak evening and night"))
# vehiculo
dataSurveyA3$vehiculo<-factor(dataSurveyA3$vehiculo,levels=c("Not available","Yes Driver","Yes ST Driver","Yes No Driver","Yes Passenger"),labels=c("Not available","Yes Driver","Yes ST Driver","Yes ST Driver","Yes Passenger"))
dataSurveyA3Processed<-dataSurveyA3
openxlsx::write.xlsx(dataSurveyA3Processed,"dataSurveyA3Processed.xlsx")
save(dataSurveyA3Processed, file = "dataSurveyA3Processed.RData")
devtools::document()
library(surveyA3Madrid)
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message=FALSE)
# setwd("C:/Users/romero/OneDrive - UNED/Papers/Paper 3/Models_R")
setwd("~/OneDrive - UNED/Papers/Paper 3/Models_R")
library("readxl")
library("tidyverse")
# Datos_Finales_Aux <- read_excel("C:/Users/romero/OneDrive - UNED/Papers/Paper 3/Models_Stata/Datos_Finales_Aux_FR_20191027.xlsx")
Datos_Finales_Aux <- read_excel("~/OneDrive - UNED/Papers/Paper 3/Models_Stata/Datos_Finales_Aux_FR_20191027.xlsx")
colnames(Datos_Finales_Aux)[which(names(Datos_Finales_Aux)=="dist_Peaje...193")]<-"dist_peaje"
colnames(Datos_Finales_Aux)[which(names(Datos_Finales_Aux)=="dist_Peaje...222")]<-"dist_peaje_bis"
colnames(Datos_Finales_Aux)[which(names(Datos_Finales_Aux)=="dur_Peaje...192")]<-"dur_peaje"
colnames(Datos_Finales_Aux)[which(names(Datos_Finales_Aux)=="dist_Peaje...223")]<-"dist_peaje_bis"
Datos_Finales_Aux<-Datos_Finales_Aux %>% select(-starts_with("P16"))%>% select(-starts_with("P17"))%>% select(-starts_with("P20"))%>% select(-starts_with("P21"))
Datos_Finales_Aux$seccion_censal<-as.character(Datos_Finales_Aux$seccion_censal)
Datos_Finales_Aux<-Datos_Finales_Aux %>% mutate(CensusSection = case_when(
seccion_censal=="2812301042" ~ "2812301008",
seccion_censal=="2812301043" ~ "2812301019",
seccion_censal=="2812301044" ~ "2812301022",
seccion_censal=="2812301045" ~ "2812301037",
TRUE ~ seccion_censal))
# Output_Cluster <- read_excel("C:/Users/romero/OneDrive - UNED/Papers/Paper 3/Excels_Resultados/Output_Cluster.xlsx")
Output_Cluster <- read_excel("~/OneDrive - UNED/Papers/Paper 3/Excels_Resultados/Output_Cluster.xlsx")
Output_Cluster$CensusSection<-as.character(Output_Cluster$CensusSection)
colnames(Output_Cluster)[which(names(Output_Cluster)=="Input_Cl_1_RA_1")]<-"ArgRiv_Cluster_Income"
colnames(Output_Cluster)[which(names(Output_Cluster)=="Input_Cl_2_RA_4")]<-"ArgRiv_Cluster_Age"
colnames(Output_Cluster)[which(names(Output_Cluster)=="Input_Cl_1_RA_4")]<-"ArgRiv_Cluster_Women"
colnames(Output_Cluster)[which(names(Output_Cluster)=="Input_Cl_4_RA_7")]<-"ArgRiv_Cluster_Right_Wing"
Output_Cluster<-Output_Cluster %>% select(-starts_with("Input_"))
Datos_full<-full_join(Datos_Finales_Aux,Output_Cluster,by="CensusSection")
Datos_full$elegiria_metro<-as.numeric(Datos_full$elegiria_metro)
Datos_full$elegiria_bus<-as.numeric(Datos_full$elegiria_bus)
Datos_full$current_toll<-factor(Datos_full$current_toll,levels=c("1","2"),labels=c("Si","No"))
Datos_full$wtp<-factor(Datos_full$wtp,levels = c("1","2","3"),labels=c("Si","No","No_Destino"))
Datos_full$abono_mensual<-factor(Datos_full$abono_mensual,levels = c("1","2"),labels=c("Si","No"))
Datos_full$carpooling<-factor(Datos_full$carpooling,levels=c("1","2"),labels=c("Si","No"))
Datos_full <- Datos_full %>% mutate(descuento_carpool=case_when(
carpooling=="No" ~ 0,
TRUE ~ 3.2-carpooling_descuento))
Datos_full$seccion_censal<-factor(Datos_full$seccion_censal)
Datos_full$cluster_A_1<-factor(Datos_full$cluster_A_1)
Datos_full$cluster_A_2<-factor(Datos_full$cluster_A_2)
Datos_full$cluster_A_4<-factor(Datos_full$cluster_A_4)
Datos_full$cluster_A_5<-factor(Datos_full$cluster_A_5)
Datos_full$cluster_A_7<-factor(Datos_full$cluster_A_7)
Datos_full$cluster_A_8<-factor(Datos_full$cluster_A_8)
Datos_full$cluster_A_10<-factor(Datos_full$cluster_A_10)
Datos_full$cluster_A_11<-factor(Datos_full$cluster_A_11)
Datos_full$cluster_RA_1<-factor(Datos_full$cluster_RA_1)
Datos_full$cluster_RA_2<-factor(Datos_full$cluster_RA_2)
Datos_full$cluster_RA_3<-factor(Datos_full$cluster_RA_3)
Datos_full$cluster_RA_4<-factor(Datos_full$cluster_RA_4)
Datos_full$cluster_RA_5<-factor(Datos_full$cluster_RA_5)
Datos_full$cluster_RA_6<-factor(Datos_full$cluster_RA_6)
Datos_full$cluster_RA_7<-factor(Datos_full$cluster_RA_7)
Datos_full$cluster_RA_8<-factor(Datos_full$cluster_RA_8)
Datos_full$cluster_RA_9<-factor(Datos_full$cluster_RA_9)
Datos_full$cluster_RA_10<-factor(Datos_full$cluster_RA_10)
Datos_full$cluster_RA_11<-factor(Datos_full$cluster_RA_11)
Datos_full$cluster_RA_12<-factor(Datos_full$cluster_RA_12)
Datos_full$municipio <- factor(Datos_full$municipio, levels=c(28014,28123),labels = c("Arganda","Rivas"))
Datos_full$zona_metro<-factor(Datos_full$zona_metro)
Datos_full$Parada_bus<-factor(Datos_full$Parada_bus)
Datos_full$Distrito_Destino_Name<-factor(Datos_full$Distrito_Destino_Name)
Datos_full$Barrio_Destino_Name<-factor(Datos_full$Barrio_Destino_Name)
Datos_full$edad_cat<-factor(Datos_full$edad_cat,levels = c(1:6),labels=c("Under 16","From 16 to 26","From 27 to 34","From 35 to 49","From 50 to 64","Above 64"))
Datos_full$genero<-factor(Datos_full$genero,levels = c(1,2),labels=c("Male","Female"))
Datos_full$ingreso<-factor(Datos_full$ingreso,levels = c(1,2,3,4,5,99),labels=c("Under 900 €","From 900 € to 1600 €","From 1600 € to 2500 €", "From 2500 € to 3000 €", "Above 3000 €", "Not responding"))
Datos_full$estudios<-factor(Datos_full$estudios,levels = c(1:4),labels=c("No studies","Primary studies","Secondary studies","University studies"))
Datos_full$sit_laboral<- factor(Datos_full$sit_laboral,levels=c(1:9),labels=c("Employed","Student","Employed Student","Unpaid domestic labour","Retired","Pensioner","Unemployed Looking","Unemployed Not Looking","Other situation"))
Datos_full$vehiculo <- factor(Datos_full$vehiculo,levels=c(1:5),labels=c("Not available","Yes as a driver","Yes sometimes as a driver","Yes but no as a driver","Yes as a passenger"))
Datos_full$carnet <- factor(Datos_full$carnet, levels=c(1:5),labels=c("No driving license","Moto driving license","Car driving license","Moto and car driving license","Not applicable"))
Datos_full$abono <-factor(Datos_full$abono,levels = c(2,1),labels=c("No transit pass","Yes transit pass"))
Datos_full$frec_madrid<- factor(Datos_full$frec_madrid,levels=c(1:3),labels=c("More than 3 days","1 to 3 days","Once or twice a month"))
Datos_full$frec_viaje<- factor(Datos_full$frec_viaje,levels=c(1:4),labels=c("4 or more days a week","1 to 3 days a week","Once or twice a month","Less than once a month"))
Datos_full$modo <- factor(Datos_full$modo, levels= c(1:7),labels=c("Car 1","Moto 1","Bus 1","Metro 1","Taxi 1","VTC 1","Bus Discrecional 1"))
Datos_full$modo_bis <- factor(Datos_full$modo_bis, levels= c(1:8),labels=c("Car","Moto","Bus","Metro","Taxi","VTC","Bus Discrecional","R3"))
Datos_full$tipo_dia <- factor(Datos_full$tipo_dia, levels=c(1:7),labels = c("Monday 1","Tuesday 1","Wednesday 1","Thursday 1","Friday 1","Saturday 1","Sunday 1"))
Datos_full$tipo_dia2 <- factor(Datos_full$tipo_dia2, levels=c("1","1","1","1","1","2","3"),labels = c("Weekday","Weekday","Weekday","Weekday","Weekday","Saturday","Sunday"))
Datos_full$motivo_viaje <- factor(Datos_full$motivo_viaje, levels=c(1:8),labels = c("Work Studies","Working Affairs","Personal Affairs","Leisure","Shopping","Doctor","Visiting Friends","Other purpose"))
Datos_full$motivo_viaje_2<-factor(Datos_full$motivo_viaje_2, levels=c("1","2"),labels=c("Commuting","Non commuting"))
Datos_full$ruta<-factor(Datos_full$ruta,levels=c(1:2),labels=c("A3","R3"))
Datos_full$P15_B<-factor(Datos_full$P15_B,levels=c(1:2),labels=c("Driver","Rider"))
Datos_full$hora_franja <- factor(Datos_full$hora_franja, levels=c("1","2","3","4","5","6"),labels = c("Peak morning","Non peak morning","Afternoon","Peak evening","Non peak evening","Night"))
Datos_full$solo <- factor(Datos_full$solo, levels = c(1:3),labels=c("Alone","Accompanied","Accompanied with minors"))
Datos_full$combinar<- factor(Datos_full$combinar, levels = c(1:2),labels=c("Yes","No"))
Datos_full$aspectos<- factor(Datos_full$aspectos, levels = c(1:4),labels=c("Travel time, level of congestion","Incidents: works, accidents, transit strikes","Weather","Madrid NO2 Protocol"))
Datos_full<-Datos_full %>% mutate(conocimiento=case_when(
current_toll_diff>= -0.5 & current_toll_diff<= 0.5 ~ 0,
current_toll_diff< -0.5 ~ 1,
current_toll_diff> 0.5 ~ 2,
current_toll == "No" ~ 3,
))
Datos_full$conocimiento<-factor(Datos_full$conocimiento)
Datos_full<-Datos_full %>% mutate(ahorrotiempo1=tiempo_viaje - Duracion_Coche_R3)
Datos_full<-Datos_full %>% mutate(tiempo2 = tiempo_viaje * tiempo_viaje)
openxlsx::write.xlsx(Datos_full,"Datos_full.xlsx")
dataSurveyA3<-Datos_full[,c("REGISTRO","municipio","seccion_censal","frec_madrid","genero","edad","edad_cat","sit_laboral","ingreso","estudios","carnet","vehiculo","abono","tipo_dia","tipo_dia2","P12","hora_franja","tiempo_viaje","tiempo2","motivo_viaje","motivo_viaje_2","modo","modo_bis","ruta","P15_B","combinar","solo","frec_viaje","aspectos","current_toll","current_toll_tarifa","current_toll_diff","conocimiento","wtp","wtp_tarifa","wtp_tarifa_2","abono_mensual","abono_mensual_tarifa","vineta_mensual_tarifa_2","carpooling","carpooling_descuento","carpooling_descuento_2","descuento_carpool","elegiria_bus_arganda","elegiria_bus_rivas","elegiria_bus","elegiria_metro_arganda","elegiria_metro_rivas","elegiria_metro","zona_metro","Distancia_min_metro","Parada_bus","Distrito_Destino_Name","Barrio_Destino_Name","dist_peaje","ahorrotiempo1","cluster_A_1","cluster_A_2","cluster_A_4","cluster_A_5","cluster_A_7","cluster_A_8","cluster_A_10","cluster_A_11","cluster_RA_1","cluster_RA_2","cluster_RA_3","cluster_RA_4","cluster_RA_5","cluster_RA_6","cluster_RA_7","cluster_RA_8","cluster_RA_9","cluster_RA_10","cluster_RA_11","cluster_RA_12","ArgRiv_Cluster_Income","ArgRiv_Cluster_Age","ArgRiv_Cluster_Women","ArgRiv_Cluster_Right_Wing")]
save(dataSurveyA3, file = "dataSurveyA3.RData")
dataSurveyA3$modo<-droplevels(dataSurveyA3$modo) # Quitamos VTC y Bus discreccional
dataSurveyA3$modo_bis<-droplevels(dataSurveyA3$modo_bis)# Quitamos VTC y Bus discreccional
# Unimos taxi a coche
dataSurveyA3$modo<-factor(dataSurveyA3$modo,levels=c("Car 1","Moto 1","Bus 1","Metro 1","Taxi 1"),labels=c("Car 1","Moto 1","Bus 1","Metro 1","Car 1"))
dataSurveyA3$modo_bis<-factor(dataSurveyA3$modo_bis,levels=c("Car","Moto","Bus","Metro","Taxi","R3"),labels=c("Car","Moto","Bus","Metro","Car","R3"))
# Juntamos No estudios y estudios primarios.
dataSurveyA3$estudios<-factor(dataSurveyA3$estudios,levels=c("No studies","Primary studies","Secondary studies","University studies"),labels=c("No studies or primary Studies","No studies or primary Studies","Secondary studies","University studies"))
# Carnet de conducir
dataSurveyA3$carnet<-factor(dataSurveyA3$carnet,levels=c("No driving license","Moto driving license","Car driving license","Moto and car driving license","Not applicable"),labels=c("No driving license","Moto or car driving license","Moto or car driving license","Moto and car driving license","No driving license"))
# Sit_laboral
dataSurveyA3$sit_laboral<-factor(dataSurveyA3$sit_laboral,levels=c("Employed","Student","Employed Student","Unpaid domestic labour","Retired","Pensioner","Unemployed Looking","Unemployed Not Looking","Other situation"),labels=c("Employed","Student","Student","Unpaid domestic labour","Retired, pensioner and others","Retired, pensioner and others","Unemployed Looking","Retired, pensioner and others","Retired, pensioner and others"))
# Edad
dataSurveyA3$edad_cat<-factor(dataSurveyA3$edad_cat,levels=c("Under 16","From 16 to 26","From 27 to 34","From 35 to 49","From 50 to 64","Above 64"),labels=c("Under 26","Under 26","From 27 to 34","From 35 to 49","From 50 to 64","Above 64" ))
# hora_franja
dataSurveyA3$hora_franja<-factor(dataSurveyA3$hora_franja,levels=c("Peak morning","Non peak morning","Afternoon","Peak evening","Non peak evening","Night"),labels=c("Peak morning","Non peak morning","Afternoon","Peak evening","Non peak evening and night","Non peak evening and night"))
# vehiculo
dataSurveyA3$vehiculo<-factor(dataSurveyA3$vehiculo,levels=c("Not available","Yes as a driver","Yes sometimes as a driver","Yes but no as a driver","Yes as a passenger"),labels=c("Not available","Yes as a driver","Yes sometimes as a driver","Yes sometimes as a driver","Yes as a passenger"))
dataSurveyA3Processed<-dataSurveyA3
openxlsx::write.xlsx(dataSurveyA3Processed,"dataSurveyA3Processed.xlsx")
save(dataSurveyA3Processed, file = "dataSurveyA3Processed.RData")
devtools::document()
library(surveyA3Madrid)
setwd("~/OneDrive - UNED/Papers/Paper 3/Template_R")
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message=FALSE)
# setwd("C:/Users/romero/OneDrive - UNED/Papers/Paper 3/Models_R")
setwd("~/OneDrive - UNED/Papers/Paper 3/Models_R")
library("readxl")
library("tidyverse")
# Datos_Finales_Aux <- read_excel("C:/Users/romero/OneDrive - UNED/Papers/Paper 3/Models_Stata/Datos_Finales_Aux_FR_20191027.xlsx")
Datos_Finales_Aux <- read_excel("~/OneDrive - UNED/Papers/Paper 3/Models_Stata/Datos_Finales_Aux_FR_20191027.xlsx")
colnames(Datos_Finales_Aux)[which(names(Datos_Finales_Aux)=="dist_Peaje...193")]<-"dist_peaje"
colnames(Datos_Finales_Aux)[which(names(Datos_Finales_Aux)=="dist_Peaje...222")]<-"dist_peaje_bis"
colnames(Datos_Finales_Aux)[which(names(Datos_Finales_Aux)=="dur_Peaje...192")]<-"dur_peaje"
colnames(Datos_Finales_Aux)[which(names(Datos_Finales_Aux)=="dist_Peaje...223")]<-"dist_peaje_bis"
Datos_Finales_Aux<-Datos_Finales_Aux %>% select(-starts_with("P16"))%>% select(-starts_with("P17"))%>% select(-starts_with("P20"))%>% select(-starts_with("P21"))
Datos_Finales_Aux$seccion_censal<-as.character(Datos_Finales_Aux$seccion_censal)
Datos_Finales_Aux<-Datos_Finales_Aux %>% mutate(CensusSection = case_when(
seccion_censal=="2812301042" ~ "2812301008",
seccion_censal=="2812301043" ~ "2812301019",
seccion_censal=="2812301044" ~ "2812301022",
seccion_censal=="2812301045" ~ "2812301037",
TRUE ~ seccion_censal))
# Output_Cluster <- read_excel("C:/Users/romero/OneDrive - UNED/Papers/Paper 3/Excels_Resultados/Output_Cluster.xlsx")
Output_Cluster <- read_excel("~/OneDrive - UNED/Papers/Paper 3/Excels_Resultados/Output_Cluster.xlsx")
Output_Cluster$CensusSection<-as.character(Output_Cluster$CensusSection)
colnames(Output_Cluster)[which(names(Output_Cluster)=="Input_Cl_1_RA_1")]<-"ArgRiv_Cluster_Income"
colnames(Output_Cluster)[which(names(Output_Cluster)=="Input_Cl_2_RA_4")]<-"ArgRiv_Cluster_Age"
colnames(Output_Cluster)[which(names(Output_Cluster)=="Input_Cl_1_RA_4")]<-"ArgRiv_Cluster_Women"
colnames(Output_Cluster)[which(names(Output_Cluster)=="Input_Cl_4_RA_7")]<-"ArgRiv_Cluster_Right_Wing"
Output_Cluster<-Output_Cluster %>% select(-starts_with("Input_"))
Datos_full<-full_join(Datos_Finales_Aux,Output_Cluster,by="CensusSection")
Datos_full$elegiria_metro<-as.numeric(Datos_full$elegiria_metro)
Datos_full$elegiria_bus<-as.numeric(Datos_full$elegiria_bus)
Datos_full$current_toll<-factor(Datos_full$current_toll,levels=c("1","2"),labels=c("Si","No"))
Datos_full$wtp<-factor(Datos_full$wtp,levels = c("1","2","3"),labels=c("Si","No","No_Destino"))
Datos_full$abono_mensual<-factor(Datos_full$abono_mensual,levels = c("1","2"),labels=c("Si","No"))
Datos_full$carpooling<-factor(Datos_full$carpooling,levels=c("1","2"),labels=c("Si","No"))
Datos_full <- Datos_full %>% mutate(descuento_carpool=case_when(
carpooling=="No" ~ 0,
TRUE ~ 3.2-carpooling_descuento))
Datos_full$seccion_censal<-factor(Datos_full$seccion_censal)
Datos_full$cluster_A_1<-factor(Datos_full$cluster_A_1)
Datos_full$cluster_A_2<-factor(Datos_full$cluster_A_2)
Datos_full$cluster_A_4<-factor(Datos_full$cluster_A_4)
Datos_full$cluster_A_5<-factor(Datos_full$cluster_A_5)
Datos_full$cluster_A_7<-factor(Datos_full$cluster_A_7)
Datos_full$cluster_A_8<-factor(Datos_full$cluster_A_8)
Datos_full$cluster_A_10<-factor(Datos_full$cluster_A_10)
Datos_full$cluster_A_11<-factor(Datos_full$cluster_A_11)
Datos_full$cluster_RA_1<-factor(Datos_full$cluster_RA_1)
Datos_full$cluster_RA_2<-factor(Datos_full$cluster_RA_2)
Datos_full$cluster_RA_3<-factor(Datos_full$cluster_RA_3)
Datos_full$cluster_RA_4<-factor(Datos_full$cluster_RA_4)
Datos_full$cluster_RA_5<-factor(Datos_full$cluster_RA_5)
Datos_full$cluster_RA_6<-factor(Datos_full$cluster_RA_6)
Datos_full$cluster_RA_7<-factor(Datos_full$cluster_RA_7)
Datos_full$cluster_RA_8<-factor(Datos_full$cluster_RA_8)
Datos_full$cluster_RA_9<-factor(Datos_full$cluster_RA_9)
Datos_full$cluster_RA_10<-factor(Datos_full$cluster_RA_10)
Datos_full$cluster_RA_11<-factor(Datos_full$cluster_RA_11)
Datos_full$cluster_RA_12<-factor(Datos_full$cluster_RA_12)
Datos_full$municipio <- factor(Datos_full$municipio, levels=c(28014,28123),labels = c("Arganda","Rivas"))
Datos_full$zona_metro<-factor(Datos_full$zona_metro)
Datos_full$Parada_bus<-factor(Datos_full$Parada_bus)
Datos_full$Distrito_Destino_Name<-factor(Datos_full$Distrito_Destino_Name)
Datos_full$Barrio_Destino_Name<-factor(Datos_full$Barrio_Destino_Name)
Datos_full$edad_cat<-factor(Datos_full$edad_cat,levels = c(1:6),labels=c("Under 16","From 16 to 26","From 27 to 34","From 35 to 49","From 50 to 64","Above 64"))
Datos_full$genero<-factor(Datos_full$genero,levels = c(1,2),labels=c("Male","Female"))
Datos_full$ingreso<-factor(Datos_full$ingreso,levels = c(1,2,3,4,5,99),labels=c("Under 900 €","From 900 € to 1600 €","From 1600 € to 2500 €", "From 2500 € to 3000 €", "Above 3000 €", "Not responding"))
Datos_full$estudios<-factor(Datos_full$estudios,levels = c(1:4),labels=c("No studies","Primary studies","Secondary studies","University studies"))
Datos_full$sit_laboral<- factor(Datos_full$sit_laboral,levels=c(1:9),labels=c("Employed","Student","Employed Student","Unpaid domestic labour","Retired","Pensioner","Unemployed Looking","Unemployed Not Looking","Other situation"))
Datos_full$vehiculo <- factor(Datos_full$vehiculo,levels=c(1:5),labels=c("Not available","Yes as a driver","Yes sometimes as a driver","Yes but no as a driver","Yes as a passenger"))
Datos_full$carnet <- factor(Datos_full$carnet, levels=c(1:5),labels=c("No driving license","Moto driving license","Car driving license","Moto and car driving license","Not applicable"))
Datos_full$abono <-factor(Datos_full$abono,levels = c(2,1),labels=c("No transit pass","Yes transit pass"))
Datos_full$frec_madrid<- factor(Datos_full$frec_madrid,levels=c(1:3),labels=c("More than 3 days","1 to 3 days","Once or twice a month"))
Datos_full$frec_viaje<- factor(Datos_full$frec_viaje,levels=c(1:4),labels=c("4 or more days a week","1 to 3 days a week","Once or twice a month","Less than once a month"))
Datos_full$modo <- factor(Datos_full$modo, levels= c(1:7),labels=c("Car 1","Moto 1","Bus 1","Metro 1","Taxi 1","VTC 1","Bus Discrecional 1"))
Datos_full$modo_bis <- factor(Datos_full$modo_bis, levels= c(1:8),labels=c("Car","Moto","Bus","Metro","Taxi","VTC","Bus Discrecional","R3"))
Datos_full$tipo_dia <- factor(Datos_full$tipo_dia, levels=c(1:7),labels = c("Monday 1","Tuesday 1","Wednesday 1","Thursday 1","Friday 1","Saturday 1","Sunday 1"))
Datos_full$tipo_dia2 <- factor(Datos_full$tipo_dia2, levels=c("1","1","1","1","1","2","3"),labels = c("Weekday","Weekday","Weekday","Weekday","Weekday","Saturday","Sunday"))
Datos_full$motivo_viaje <- factor(Datos_full$motivo_viaje, levels=c(1:8),labels = c("Work Studies","Working Affairs","Personal Affairs","Leisure","Shopping","Doctor","Visiting Friends","Other purpose"))
Datos_full$motivo_viaje_2<-factor(Datos_full$motivo_viaje_2, levels=c("1","2"),labels=c("Commuting","Non commuting"))
Datos_full$ruta<-factor(Datos_full$ruta,levels=c(1:2),labels=c("A3","R3"))
Datos_full$P15_B<-factor(Datos_full$P15_B,levels=c(1:2),labels=c("Driver","Rider"))
Datos_full$hora_franja <- factor(Datos_full$hora_franja, levels=c("1","2","3","4","5","6"),labels = c("Peak morning","Non peak morning","Afternoon","Peak evening","Non peak evening","Night"))
Datos_full$solo <- factor(Datos_full$solo, levels = c(1:3),labels=c("Alone","Accompanied","Accompanied with minors"))
Datos_full$combinar<- factor(Datos_full$combinar, levels = c(1:2),labels=c("Yes","No"))
Datos_full$aspectos<- factor(Datos_full$aspectos, levels = c(1:4),labels=c("Travel time, level of congestion","Incidents: works, accidents, transit strikes","Weather","Madrid NO2 Protocol"))
Datos_full<-Datos_full %>% mutate(conocimiento=case_when(
current_toll_diff>= -0.5 & current_toll_diff<= 0.5 ~ 0,
current_toll_diff< -0.5 ~ 1,
current_toll_diff> 0.5 ~ 2,
current_toll == "No" ~ 3,
))
Datos_full$conocimiento<-factor(Datos_full$conocimiento, levels=0:3,labels=c("Correct estimation of the toll rate within a margin of €0.5","Underestimation of the toll rate of more than €0.50","Overestimation of the toll rate of more than €0.50","Do not estimate the toll rate"))
Datos_full<-Datos_full %>% mutate(ahorrotiempo1=tiempo_viaje - Duracion_Coche_R3)
Datos_full<-Datos_full %>% mutate(tiempo2 = tiempo_viaje * tiempo_viaje)
openxlsx::write.xlsx(Datos_full,"Datos_full.xlsx")
dataSurveyA3<-Datos_full[,c("REGISTRO","municipio","seccion_censal","frec_madrid","genero","edad","edad_cat","sit_laboral","ingreso","estudios","carnet","vehiculo","abono","tipo_dia","tipo_dia2","P12","hora_franja","tiempo_viaje","tiempo2","motivo_viaje","motivo_viaje_2","modo","modo_bis","ruta","P15_B","combinar","solo","frec_viaje","aspectos","current_toll","current_toll_tarifa","current_toll_diff","conocimiento","wtp","wtp_tarifa","wtp_tarifa_2","abono_mensual","abono_mensual_tarifa","vineta_mensual_tarifa_2","carpooling","carpooling_descuento","carpooling_descuento_2","descuento_carpool","elegiria_bus_arganda","elegiria_bus_rivas","elegiria_bus","elegiria_metro_arganda","elegiria_metro_rivas","elegiria_metro","zona_metro","Distancia_min_metro","Parada_bus","Distrito_Destino_Name","Barrio_Destino_Name","dist_peaje","ahorrotiempo1","cluster_A_1","cluster_A_2","cluster_A_4","cluster_A_5","cluster_A_7","cluster_A_8","cluster_A_10","cluster_A_11","cluster_RA_1","cluster_RA_2","cluster_RA_3","cluster_RA_4","cluster_RA_5","cluster_RA_6","cluster_RA_7","cluster_RA_8","cluster_RA_9","cluster_RA_10","cluster_RA_11","cluster_RA_12","ArgRiv_Cluster_Income","ArgRiv_Cluster_Age","ArgRiv_Cluster_Women","ArgRiv_Cluster_Right_Wing")]
save(dataSurveyA3, file = "dataSurveyA3.RData")
dataSurveyA3$modo<-droplevels(dataSurveyA3$modo) # Quitamos VTC y Bus discreccional
dataSurveyA3$modo_bis<-droplevels(dataSurveyA3$modo_bis)# Quitamos VTC y Bus discreccional
# Unimos taxi a coche
dataSurveyA3$modo<-factor(dataSurveyA3$modo,levels=c("Car 1","Moto 1","Bus 1","Metro 1","Taxi 1"),labels=c("Car 1","Moto 1","Bus 1","Metro 1","Car 1"))
dataSurveyA3$modo_bis<-factor(dataSurveyA3$modo_bis,levels=c("Car","Moto","Bus","Metro","Taxi","R3"),labels=c("Car","Moto","Bus","Metro","Car","R3"))
# Juntamos No estudios y estudios primarios.
dataSurveyA3$estudios<-factor(dataSurveyA3$estudios,levels=c("No studies","Primary studies","Secondary studies","University studies"),labels=c("No studies or primary Studies","No studies or primary Studies","Secondary studies","University studies"))
# Carnet de conducir
dataSurveyA3$carnet<-factor(dataSurveyA3$carnet,levels=c("No driving license","Moto driving license","Car driving license","Moto and car driving license","Not applicable"),labels=c("No driving license","Moto or car driving license","Moto or car driving license","Moto and car driving license","No driving license"))
# Sit_laboral
dataSurveyA3$sit_laboral<-factor(dataSurveyA3$sit_laboral,levels=c("Employed","Student","Employed Student","Unpaid domestic labour","Retired","Pensioner","Unemployed Looking","Unemployed Not Looking","Other situation"),labels=c("Employed","Student","Student","Unpaid domestic labour","Retired, pensioner and others","Retired, pensioner and others","Unemployed Looking","Retired, pensioner and others","Retired, pensioner and others"))
# Edad
dataSurveyA3$edad_cat<-factor(dataSurveyA3$edad_cat,levels=c("Under 16","From 16 to 26","From 27 to 34","From 35 to 49","From 50 to 64","Above 64"),labels=c("Under 26","Under 26","From 27 to 34","From 35 to 49","From 50 to 64","Above 64" ))
# hora_franja
dataSurveyA3$hora_franja<-factor(dataSurveyA3$hora_franja,levels=c("Peak morning","Non peak morning","Afternoon","Peak evening","Non peak evening","Night"),labels=c("Peak morning","Non peak morning","Afternoon","Peak evening","Non peak evening and night","Non peak evening and night"))
# vehiculo
dataSurveyA3$vehiculo<-factor(dataSurveyA3$vehiculo,levels=c("Not available","Yes as a driver","Yes sometimes as a driver","Yes but no as a driver","Yes as a passenger"),labels=c("Not available","Yes as a driver","Yes sometimes as a driver","Yes sometimes as a driver","Yes as a passenger"))
dataSurveyA3Processed<-dataSurveyA3
openxlsx::write.xlsx(dataSurveyA3Processed,"dataSurveyA3Processed.xlsx")
save(dataSurveyA3Processed, file = "dataSurveyA3Processed.RData")
devtools::document()
library(surveyA3Madrid)
